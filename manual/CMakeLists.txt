project (manual)

find_package (HTMLHelp)

if (NOT HTML_HELP_COMPILER)
  return ()
endif (NOT HTML_HELP_COMPILER)

set (_NAME TeXnicCenter)
SET (_OUTPUT_FILE ${_NAME}.hhp)
set (_DIRECTORY ${CMAKE_BINARY_DIR})
set (BUILD_DIR ${CMAKE_CURRENT_SOURCE_DIR})
set (_COPY_OUTPUT_DIR ${_DIRECTORY}/${CMAKE_CFG_INTDIR})
SET (_OUTPUT_DOC_FILE ${BUILD_DIR}/${_NAME}.chm)
set (_TARGET manual)

SET (_BUILD_SCRIPT
  ${CMAKE_CURRENT_BINARY_DIR}/sphinx-htmlhelp-build.cmake)
FILE (WRITE ${_BUILD_SCRIPT}
"
EXECUTE_PROCESS (COMMAND \${HTML_HELP_COMPILER} \${OUTPUT_NAME}
  WORKING_DIRECTORY \${BUILD_DIR} RESULT_VARIABLE _RESULT)
")

ADD_CUSTOM_TARGET (${_TARGET}
  COMMAND ${CMAKE_COMMAND}
          -DHTML_HELP_COMPILER=${HTML_HELP_COMPILER}
          -DBUILD_DIR=${BUILD_DIR}
          -DOUTPUT_NAME=${_OUTPUT_FILE}
          -P ${_BUILD_SCRIPT}
  COMMAND ${CMAKE_COMMAND} -E make_directory ${_COPY_OUTPUT_DIR}
  COMMAND ${CMAKE_COMMAND} -E copy ${_OUTPUT_DOC_FILE} ${_COPY_OUTPUT_DIR}
  COMMENT "Generating ${_NAME} manual"
)
